\chapter{Policy}

In this chapter, we introduce the policies in our system.
There are three dispatching policies --- \emph{priority-based},
\emph{proportion-based} and \emph{deadline-based}.
Each policy requires different parameters such as job priority,
execution efficiency per different server and execution deadline.
The decision maker makes dispatching plans to according to a specified
policy.

When designing the schedule policies, one should take the number of
tasks a job is split into consideration since we don't want to assign
workers more than tasks of a job to it.
Recall that it is the end users' responsibility to split a job into well
balanced tasks; the more balanced the tasks, the better the system
schedules.


\section{Priority-based Policy}

%%% Introduce Priority-based
\emph{Priority-based} distributes workloads according to job priority. 
The idea behind this policy is to make the job with highest priority runs as
fast as possible.
Intuitively, we can sort the jobs according to their priority then greedily
schedule as many workers as possible to each job in that order.
However, this might cause \emph{starvation} that lower priority jobs never get
executed.

% TODO try to say more...
% TODO Dissemble the topic sentence
%%% How we avoid starvation from happening
To avoid \emph{starvation}, we preserve a portion $r \in [0,1]$ of workers for
low priority jobs and job with the highest priority can use only the
unpreserved workers.
The algorithm is shown as Algorithm~\ref{algo:priority-based}.

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \input{snippets/policies/priority-based-policy}
  \caption{Priority-based policy}
  \label{algo:priority-based}
\end{algorithm}

\section{Proportion-based Policy}

In contrast to priority-based, this policy is takes job priorities into
consideration very little; instead, the main concern of this policy is
the workload proportion of a job to all the others.
This algorithm, as shown in algorithm~\ref{algo:proportion-based}, is
also known as fair share scheduling: workers a job should be allocated
is in proportion to its workload proportion to all jobs. 

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \input{snippets/policies/proportion-based-policy}
  \caption{Proportion-based policy}
  \label{algo:proportion-based}
\end{algorithm}

\section{Workload-based Policy}

Similar to the proportion-based policy, the main concern of the
workload-based policy is the workload of the job.
The main difference is, rather than fair sharing, this policy tends to
meet the workload requirement of high priority jobs.

\subsection{Model Definition}

We represent each job $J_i$ submitted as $J_i = (W_i, P_i, N_i)$, where
$W_i, P_i, N_i$ represents the estimated workload, priority and the
number of task of $J_i$ respectively.
As for the workers, we model each worker $S_j$ as a vector of estimated
\emph{throughput} of each submitted job; we can write is as $S_J =
(th_1, th_2, \ldots)$

% TODO Server model

\subsection{Algorithm}

The approach is a simple greedy method:
First, sort the jobs by priority.
For each job $J_m$, sort remaining workers according to its $th_m$,
assign top $k$ workers that just satisfies the workload requirement of
$J_m$ and remove assigned workers from the list.

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \input{snippets/policies/workload-based-policy}
  \caption{Deadline-based policy}
  \label{algo:deadline-based}
\end{algorithm}

\section{Deadline-based Policy}

Plenty kinds of jobs must be finished before a given deadline.
For example, as a Internet service provider, settling monthly bills of
millions of users within few days after the monthly charge-off day is
very critical to their business.
It it obvious that computing resource allocated this kind of job should
increase as their deadline approaches --- the closer the deadline is, the
more worker a job should get.
% TODO should I use "introduce"? It's the most critical idea we proposed
Unfortunately, policies introduced in previous sections can't adapt to
this need; hence, we introduce another policy designed for
\emph{deadline-aware} scenarios.

\subsection{Model Definition}

For this policy, we assume that each job is provided with priority and
deadline.
A job $J_i$ can thus be represented as $J_i = (P_i, D_i, N_i)$, where
$P_i, D_i\text{ and }N_i$ refers to the priority, deadline and the
number of tasks of $J_i$ respectively.


\subsection{Algorithm}

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \input{snippets/policies/deadline-based-policy}
  \caption{Deadline-based policy}
  \label{algo:deadline-based}
\end{algorithm}
