\chapter{Policy}

In this chapter, we introduce the policies in our system.
There are three dispatching policies -- \emph{priority-based},
\emph{proportion-based} and \emph{deadline-based}.
Each policy requires different parameters such as job priority,
execution efficiency per different server and execution deadline.
The decision maker makes dispatching plans to according to a specified
policy.


\section{Priority-based Policy}

%%% Introduce Priority-based
\emph{Priority-based} distributes workloads according to job priority. 
The idea behind this policy is to make the job with highest priority runs as
fast as possible.
Intuitively, we can sort the jobs according to their priority then greedily
schedule as many workers as possible to each job in that order.
However, this might cause \emph{starvation} that lower priority jobs never get
executed.

% TODO try to say more...
% TODO Dissemble the topic sentence
%%% How we avoid starvation from happening
To avoid \emph{starvation}, we preserve a portion $r \in [0,1]$ of workers for
low priority jobs and job with the highest priority can use only the
unpreserved workers.
The algorithm is shown as Algorithm~\ref{algo:priority-based}.

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \KwIn{
    $workerSet=\{w_1, w_2, \ldots, w_m\}$,
    $jobSet=\{j_1, j_2, \ldots, j_n\}$,
    preserving rate $r\in[0,1]$
  }
  \KwOut{A mapping of each job to scheduled workers}
  $result \gets$
  KeyValueMap(key $\to \{\}$ for all key $\in jobSet$)\;
  $jobSet \gets$ $sortByPriority(jobSet)$\;
  $c \gets$ $min(jobSet[0]$.totalTask, $workerSet$.size$-floor((1-r) *
      workerSet.$size$)$\;
  $result[jobSet[0]] \gets$ $\{w_1, ..., w_c\}$\;
  \For{$i=1$ to $min(m-c, n)$}{
    $result[jobSet[i]]$ $\gets$ $\{w_{c+i}\}$\;
  }
  \Return{result}\;
  \caption{Priority-based policy}
  \label{algo:priority-based}
\end{algorithm}

\section{Proportion-based Policy}

In contrast to priority-based, this policy is takes job priorities into
consideration very little; instead, the main concern of this policy is
the workload proportion of a job to all the others.
This algorithm, as shown in algorithm~\ref{algo:proportion-based}, is
also known as fair share scheduling: workers a job should be allocated
is in proportion to its workload proportion to all jobs. 

\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \KwIn{
    $workerSet=\{w_1, w_2, \ldots, w_m\}$,
    $jobSet=\{j_1, j_2, \ldots, j_n\}$,
  }
  \KwOut{A mapping of each job to scheduled workers}
  $result \gets$ KeyValueMap(key $\to \{\}$ for all key $\in$
  $jobSet$)\;
  $jobSet \gets$ $sortByPriority(jobSet)$\;
  \For{$i=1$ to $m$}{
    break if $workerSet$.size equals to 0 \;
    $c \gets$
    $min(ceil(\frac{jobSet[i].\text{workload}}{\text{total
        workload}})), workerSet.\text{size})$ \;
    $result[jobSet[i]] \gets \{\text{first $c$ element of
    $workerSet$}\}$\;
    $workerSet \setminus result[jobSet[i]]$\;
  }
  \Return{result}\;
  \caption{Proportion-based policy}
  \label{algo:proportion-based}
\end{algorithm}

\section{Deadline-based Policy}

Plenty kinds of jobs must be finished before a given deadline.
For example, as a Internet service provider, settling monthly bills of
millions of users within few days after the monthly charge-off day is
very critical to their business.
It it obvious that computing resource allocated this kind of job should
increase as their deadline approaches -- the closer the deadline is, the
more worker a job should get.
% TODO should I use "introduce"? It's the most critical idea we proposed
Unfortunately, policies introduced in previous sections can't adapt to
this need; hence, we introduce another policy designed for
\emph{deadline-aware} scenarios.

\subsection{Model Definition}


\subsection{Algorithm}
\begin{algorithm}[H]
  \DontPrintSemicolon % Some LaTeX compilers require you to use
  \KwIn{
    $workerSet=\{w_1, w_2, \ldots, w_m\}$,
    $jobSet=\{j_1, j_2, \ldots, j_n\}$,
  }
  \KwOut{A mapping of each job to scheduled workers}
  % TODO Implement the algorithm

  \Return{result}\;
  \caption{Deadline-based policy}
  \label{algo:deadline-based}
\end{algorithm}
